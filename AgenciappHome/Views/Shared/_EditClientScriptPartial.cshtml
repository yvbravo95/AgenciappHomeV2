<!--Script para cargar las ciudades-->
<link rel="stylesheet" type="text/css" href="~/app-assets/vendors/css/pickers/datetime/bootstrap-datetimepicker.css">
<script type="text/javascript" src="~/app-assets/vendors/js/pickers/dateTime/moment-with-locales.min.js"></script>
<script type="text/javascript" src="~/app-assets/vendors/js/pickers/dateTime/bootstrap-datetimepicker.min.js"></script>
<script>
    $(document).ready(function () {
        $(".date-picker").datetimepicker({
            format: 'MM/DD/YYYY',
            viewMode: "years",
            widgetPositioning: {
                horizontal: 'auto',
                vertical: 'bottom'
            },
            extraFormats: ["YYYY-MM-DD"]
        }).on("dp.change", function (e) {
            var mirrorId = $(this).data("input");
            if (mirrorId) {
                var mirror = $("#" + mirrorId);
                mirror.val(new Date(e.date).toISOString().substr(0, 10)).trigger("change");
            }
        });

        $("#EditfechaNac").mask("99/99/9999")
        $("#ClientPassportExpire").mask("99/99/9999")

        $("select[id=EditClientState]").empty()
        $("select[id=EditClientState]").append(new Option())
        $("select[id=EditClientState]").append(new Option("Alabama", "Alabama"))
        $("select[id=EditClientState]").append(new Option("Alaska", "Alaska"))
        $("select[id=EditClientState]").append(new Option("American Samoa", "American Samoa"))
        $("select[id=EditClientState]").append(new Option("Arizona", "Arizona"))
        $("select[id=EditClientState]").append(new Option("Arkansas", "Arkansas"))
        $("select[id=EditClientState]").append(new Option("Armed Forces Americas", "Armed Forces Americas"))
        $("select[id=EditClientState]").append(new Option("Armed Forces Europe, Canada, Africa and Middle East", "Armed Forces Europe, Canada, Africa and Middle East"))
        $("select[id=EditClientState]").append(new Option("Armed Forces Pacific", "Armed Forces Pacific"))
        $("select[id=EditClientState]").append(new Option("California", "California"))
        $("select[id=EditClientState]").append(new Option("Colorado", "Colorado"))
        $("select[id=EditClientState]").append(new Option("Connecticut", "Connecticut"))
        $("select[id=EditClientState]").append(new Option("Delaware", "Delaware"))
        $("select[id=EditClientState]").append(new Option("District of Columbia", "District of Columbia"))
        $("select[id=EditClientState]").append(new Option("Florida", "Florida"))
        $("select[id=EditClientState]").append(new Option("Georgia", "Georgia"))
        $("select[id=EditClientState]").append(new Option("Guam", "Guam"))
        $("select[id=EditClientState]").append(new Option("Hawaii", "Hawaii"))
        $("select[id=EditClientState]").append(new Option("Idaho", "Idaho"))
        $("select[id=EditClientState]").append(new Option("Illinois", "Illinois"))
        $("select[id=EditClientState]").append(new Option("Indiana", "Indiana"))
        $("select[id=EditClientState]").append(new Option("Iowa", "Iowa"))
        $("select[id=EditClientState]").append(new Option("Kansas", "Kansas"))
        $("select[id=EditClientState]").append(new Option("Kentucky", "Kentucky"))
        $("select[id=EditClientState]").append(new Option("Luisiana", "Luisiana"))
        $("select[id=EditClientState]").append(new Option("Maine", "Maine"))
        $("select[id=EditClientState]").append(new Option("Marshall Islands", "Marshall Islands"))
        $("select[id=EditClientState]").append(new Option("Maryland", "Maryland"))
        $("select[id=EditClientState]").append(new Option("Massachusetts", "Massachusetts"))
        $("select[id=EditClientState]").append(new Option("Michigan", "Michigan"))
        $("select[id=EditClientState]").append(new Option("Micronesia", "Micronesia"))
        $("select[id=EditClientState]").append(new Option("Minnesota", "Minnesota"))
        $("select[id=EditClientState]").append(new Option("Mississippi", "Mississippi"))
        $("select[id=EditClientState]").append(new Option("Missouri", "Missouri"))
        $("select[id=EditClientState]").append(new Option("Montana", "Montana"))
        $("select[id=EditClientState]").append(new Option("Nebraska", "Nebraska"))
        $("select[id=EditClientState]").append(new Option("Nevada", "Nevada"))
        $("select[id=EditClientState]").append(new Option("New Hampshire", "New Hampshire"))
        $("select[id=EditClientState]").append(new Option("New Jersey", "New Jersey"))
        $("select[id=EditClientState]").append(new Option("New Mexico", "New Mexico"))
        $("select[id=EditClientState]").append(new Option("New York", "New York"))
        $("select[id=EditClientState]").append(new Option("North Carolina", "North Carolina"))
        $("select[id=EditClientState]").append(new Option("North Dakota", "North Dakota"))
        $("select[id=EditClientState]").append(new Option("Northern Mariana Islands", "Northern Mariana Islands"))
        $("select[id=EditClientState]").append(new Option("Ohio", "Ohio"))
        $("select[id=EditClientState]").append(new Option("Oklahoma", "Oklahoma"))
        $("select[id=EditClientState]").append(new Option("Oregon", "Oregon"))
        $("select[id=EditClientState]").append(new Option("Palau", "Palau"))
        $("select[id=EditClientState]").append(new Option("Pennsylvania", "Pennsylvania"))
        $("select[id=EditClientState]").append(new Option("Puerto Rico", "Puerto Rico"))
        $("select[id=EditClientState]").append(new Option("Rhode Island", "Rhode Island"))
        $("select[id=EditClientState]").append(new Option("South Carolina", "South Carolina"))
        $("select[id=EditClientState]").append(new Option("South Dakota", "South Dakota"))
        $("select[id=EditClientState]").append(new Option("Tennessee", "Tennessee"))
        $("select[id=EditClientState]").append(new Option("Texas", "Texas"))
        $("select[id=EditClientState]").append(new Option("Utah", "Utah"))
        $("select[id=EditClientState]").append(new Option("Vermont", "Vermont"))
        $("select[id=EditClientState]").append(new Option("Virgin Islands", "Virgin Islands"))
        $("select[id=EditClientState]").append(new Option("Virginia", "Virginia"))
        $("select[id=EditClientState]").append(new Option("Washington", "Washington"))
        $("select[id=EditClientState]").append(new Option("West Virginia", "West Virginia"))
        $("select[id=EditClientState]").append(new Option("Wisconsin", "Wisconsin"))
        $("select[id=EditClientState]").append(new Option("Wyoming", "Wyoming"))

        $("#editarCliente").on("click", () => {
            $("#EditName").val(selectedClientData.name)
            $("#EditName2").val(selectedClientData.name2)
            $("#EditLastname").val(selectedClientData.lastName)
            $("#EditLastname2").val(selectedClientData.lastName2)
            $("#EditPhone").val(selectedClientData.movil)
            $("#EditEmail").val(selectedClientData.email)
            $("#EditID").val(selectedClientData.id)
            $("#EditAddress").val(selectedClientData.calle)
            $("#EditZip").val(selectedClientData.zip)
            $("#ClientPassportNumber").val(selectedClientData.passportNumber)
            $("#ClientPassportExpire").val(moment(selectedClientData.passportExpireDate).format('MM/DD/YYYY'));
            console.log(moment(selectedClientData.passportExpireDate).format('MM/DD/YYYY'));
            var valueDate = selectedClientData.fechaNac.slice(0, 10);
            if (valueDate == "0001-01-01")
                valueDate = "";
            var m = valueDate.match(/^(\d{4})(\/|-)?(\d{1,2})(\/|-)?(\d{1,2})$/);
            if (m)
                valueDate = ("00" + m[3]).slice(-2) + '/' + ("00" + m[5]).slice(-2) + '/' + m[1];

            $('#EditfechaNac').val(valueDate);
            $("#EditClientCity").data("value", selectedClientData.city);
            $('#EditClientState').val(selectedClientData.state).trigger("change");
        })

        $("#EditClientState").on("change", () => {
            var estado = $('#EditClientState').val();
            if (estado != "")
                $.ajax({
                    url: "/Provincias/Ciudades?nombre=" + estado,
                    type: "POST",
                    dataType: "json",
                    async: true,
                    success: function (response) {
                        $("#EditClientCity").empty();
                        $("#EditClientCity").append(new Option())
                        for (var i in response) {
                            var m = response[i];
                            $("#EditClientCity").append(new Option(m, m))
                            if ($("#EditClientCity").data("value") != "" && $("#EditClientCity").data("value") != null) {
                                $("#EditClientCity").val($("#EditClientCity").data("value")).trigger("change")
                            }
                        }
                    }
                })
        })

        var validateEditarCliente = function () {
            if ($("#EditName").val() == "") {
                showWarningMessage("Atención", "El campo Nombre no puede estar vacío.");
                return false;
            } else if ($("#EditLastname").val() == "") {
                showWarningMessage("Atención", "El campo Apellidos no puede estar vacío.");
                return false;
            } else if ($("#EditPhone").val() == "") {
                showWarningMessage("Atención", "El campo Teléfono no puede estar vacío.");
                return false;
            }
            //else if ($("#EditID").val() == "") {
            //    showWarningMessage("Atención", "El campo ID no puede estar vacío.");
            //    return false;
            //}
            /*else if ($("#EditEmail").val() != "") {
                var regexEmail = /^\w+([\.-]?\w+)*@@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
                if (!regexEmail.test($("#inputClientEmail").val())) {
                    showWarningMessage("Atención", "El campo Email no tiene el formato correcto.");
                    return false;
                }
            }*/

            return true;
        };

        $("#guardarEditCliente").on("click", function () {
            if (validateEditarCliente()) {
                $.ajax({
                    async: true,
                    type: "POST",
                    contentType: "application/x-www-form-urlencoded",
                    url: "/Clients/EditClientNew",
                    data: {
                        clientId: selectedClientData.clientId,
                        name: $("#EditName").val(),
                        name2: $("#EditName2").val(),
                        lastname: $("#EditLastname").val(),
                        lastname2: $("#EditLastname2").val(),
                        phone: $("#EditPhone").val(),
                        email: $("#EditEmail").val(),
                        id: $("#EditID").val(),
                        address: $("#EditAddress").val(),
                        state: $("#EditClientState").val(),
                        city: $("#EditClientCity").val(),
                        zip: $("#EditZip").val(),
                        FechaNac: $("#EditfechaNac").val(),
                        PassportNumber: $("#ClientPassportNumber").val(),
                        PassportExpireDate: $("#ClientPassportExpire").val(),
                    },
                    beforeSend: function () {
                        $.blockUI();
                    },
                    success: function (response) {
                        if (!response.success) {
                            toastr.warning("El usuario " + $("#EditName").val() + " " + $("#EditLastname").val() + " ya existe");
                        }
                        else {
                            if (document.location.pathname == "/clients/index") {
                                document.location = "/clients/tramites/" + selectedClientData.clientId;
                            }
                            else {
                                document.location = document.location.pathname + "?msg=El usuario " + $("#Name").val() + " se ha editado satisfactoriamente.&idClient=" + selectedClientData.clientId;
                            }
                            $("#editClienteModal").modal('hide')
                        }
                    },
                    error: function () {
                        toastr.error("No se ha podido editar el usuario, vuelva a intentar", "Error");
                    },

                });

            }
        });

    });
</script>

<!--Script para guardar nuevo cliente-->
<script src="~/app-assets/vendors/js/jquery.mask/jquery.mask.min.js"></script>
<script type="text/javascript" src="~/app-assets/vendors/js/forms/select/select2.full.min.js"></script>

<script>
    var validateNuevoCliente = function () {
        if ($("#Name").val() == "") {
            showWarningMessage("Atención", "El campo Nombre no puede estar vacío.");
            return false;
        }
        if ($("#Lastname").val() == "") {
            showWarningMessage("Atención", "El campo Apellidos no puede estar vacío.");
            return false;
        }
        if ($("#Phone").val() == "") {
            showWarningMessage("Atención", "El campo Móvil no puede estar vacío.");
            return false;
        }


        return true;
    };
    var cleanNuevoCliente = function () {
        $('#Name').val("");
        $('#Lastname').val("");
        $('#Email').val("");
        $('#Phone').val("");
        $('#ID').val("");
        $('#phoneCuba').val("");
        $('#Clientstate').val("");
        $('#Clientcity').val("");
        $('#Address').val("");
        $('#Zip').val("");
        $("#acepto").attr("checked", "checked");
    };
    //$(document).ready(function () {

    //    $("#guardarNuevoCliente").on("click", function () {
    //        if (validateNuevoCliente()) {
    //            $.ajax({
    //                async: true,
    //                type: "POST",
    //                contentType: "application/x-www-form-urlencoded",
    //                url: "/Clients/AddClientNew",
    //                data: {
    //                    name: $("#Name").val(),
    //                    lastname: $("#Lastname").val(),
    //                    phone: $("#Phone").val(),
    //                    email: $("#Email").val(),
    //                    id: $("#ID").val(),
    //                    //phoneCuba: $("#phoneCuba").val(),
    //                    address: $("#Address").val(),
    //                    state: $("#Clientstate").val(),
    //                    city: $("#Clientcity").val(),
    //                    zip: $("#Zip").val(),
    //                    check: $('#acepto').is(':checked'),
    //                    FechaNac: $("#fechaNac").val(),
    //                    name2: $("#Name2").val(),
    //                    lastname2: $("#Lastname2").val()
    //                },
    //                beforeSend: function () {
    //                    $.blockUI();
    //                },
    //                success: function (response) {
    //                    if (response == "") {
    //                        toastr.warning("El usuario " + $("#Name").val() + " " + $("#Lastname").val() + " ya existe");

    //                    }
    //                    else {
    //                        if (document.location.pathname == "/clients/index") {
    //                            document.location = "/clients/tramites/" + response["idClient"];
    //                        }
    //                        else {
    //                            document.location = document.location.pathname + "?msg=El usuario " + $("#Name").val() + " se ha creado satisfactoriamente.&idClient=" + response["idClient"];
    //                        }
    //                    }
    //                },
    //                error: function () {
    //                    toastr.error("No se ha podido crear el usuario, vuelva a intentar", "Error");
    //                },

    //            });

    //            $("#nuevoClienteModal").modal('hide')
    //        }
    //    });
    //    $("#nuevoCliente").on("click", function () {
    //        cleanNuevoCliente();
    //    });
    //    $("#aceptoS").click(function () {
    //        var a = $("#acepto");
    //        a.attr("checked", function (i, value) { return !value; });
    //    })
    //    cleanNuevoCliente();
    //    $("#Clientstate").on("change", function () {
    //        lC($("#Clientstate"), $("#Clientcity"));
    //    })
    //})

    var lC = function (estado, ciudad) {
        if (!estado)
            return;

        $.ajax({
            url: "/Provincias/Ciudades?nombre=" + estado.val(),
            type: "POST",
            dataType: "json",
            success: function (response) {
                ciudad.empty();
                ciudad.append(new Option())
                for (var i in response) {
                    var m = response[i];
                    ciudad.append(new Option(m, m))
                }
            }
        })
    }
</script>

<!--Script para formato-->
<script>
    $('#EditPhone').mask('(000)-000-0000', {
        placeholder: "(000)-000-0000"
    });
    $('#EditZip').mask('00000', {
        placeholder: "Zip Code"
    });
</script>


<style>
    .demo input[type="checkbox"] {
        display: none;
    }

        .demo input[type="checkbox"] + label span {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin: -1px 4px 0 0;
            vertical-align: middle;
            background: url("/images/checkbox/checkbox-uncheck.png");
            background-size: cover;
            cursor: pointer;
        }

        .demo input[type="checkbox"][checked= "checked"] + label span {
            background: url("/images/checkbox/checkbox-check.png");
            background-size: cover;
        }

    .demo {
        margin-top: 10px;
    }
</style>
<style>
    .select2-selection__rendered {
        left: 25px;
        position: relative;
    }
</style>

